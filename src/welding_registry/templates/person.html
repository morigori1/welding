<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <title>{{ name }} の資格</title>
    <style>
      body{font-family:system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans JP', sans-serif; margin:20px}
      table{border-collapse:collapse;margin-top:12px}
      th,td{border:1px solid #ddd;padding:6px 8px}
      th{background:#f5f5f5}
      .pill{display:inline-block;padding:2px 8px;border-radius:10px;font-size:12px}
      .ok{background:#e7f7e9;color:#0a7f2e}
      .ng{background:#fde7e7;color:#a33131}
      form{margin:0}
      input[type=text]{width:260px}
    </style>
  </head>
  <body>
    <p><a href="{{ url_for('index') }}">← 一覧に戻る</a> | <a href="{{ url_for('report') }}">期限レポート</a> | <a href="{{ url_for('input_form') }}">手入力</a></p>
    <h3>{{ name }} の資格</h3>
    <table>
      <tr>
        <th>資格</th><th>登録番号</th><th>初回(登録)</th><th>継続/交付</th><th>有効</th><th>確認</th>
      </tr>
      {% for r in rows %}
        <tr>
          <td>{{ r.get('qualification','') }}</td>
          <td>{{ r.get('license_no','') }}</td>
          <td>{{ r.get('first_issue_date','') }}</td>
          <td>{{ r.get('issue_date','') }}</td>
          <td>{{ r.get('expiry_date','') }}</td>
          <td>
            <form method="post" action="{{ url_for('decision') }}">
              <input type="hidden" name="name" value="{{ name }}"/>
              <input type="hidden" name="license_no" value="{{ r.get('license_no','') }}"/>
              <button name="status" value="ok">最新</button>
              <button name="status" value="needs_update">要更新</button>
              <input type="text" name="notes" placeholder="メモ(任意)"/>
            </form>
          </td>
        </tr>
      {% endfor %}
    </table>
    {% if decisions %}
    <h4>確認履歴</h4>
    <table>
      <tr><th>登録番号</th><th>状態</th><th>メモ</th><th>時刻</th></tr>
      {% for d in decisions %}
        <tr>
          <td>{{ d.license_no or '' }}</td>
          <td><span class="pill {% if d.status=='ok' %}ok{% else %}ng{% endif %}">{{ '最新' if d.status=='ok' else '要更新' }}</span></td>
          <td>{{ d.notes or '' }}</td>
          <td>{{ d.ts|round|int }}</td>
        </tr>
      {% endfor %}
    </table>
    {% endif %}
  </body>
 </html>
